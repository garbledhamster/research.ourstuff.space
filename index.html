<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Research Loader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#111111">
  <meta name="application-name" content="Research Loader">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Research Loader">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#111111">
  <meta name="msapplication-TileImage" content="assets/favicon-square/android-chrome-512x512.png">
  <link rel="icon" type="image/x-icon" href="assets/favicon-square/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-square/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-square/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon-square/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/favicon-square/android-chrome-512x512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon-square/apple-touch-icon.png">
  <link rel="manifest" href="assets/favicon-square/site.webmanifest">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css">
  <link rel="stylesheet" href="https://unpkg.com/open-props/open-props.min.css">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  >
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="assets/site.css">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <img class="navbar-logo" src="assets/logo-circle.svg" alt="Research Loader logo">
      <h1 class="navbar-title">Research Loader</h1>
    </div>
    <div class="navbar-actions">
      <button type="button" class="navbar-button" onclick="openLibraryDrawer()" title="Library">
        <svg class="navbar-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
        <span class="navbar-button-text">Library</span>
      </button>
      <button type="button" class="navbar-button" onclick="openSettingsDrawer()" title="Settings">
        <svg class="navbar-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6m-6-6H0m6 0h6m6 0h6"></path>
          <path d="M19.07 4.93l-4.24 4.24m0 5.66l4.24 4.24M4.93 4.93l4.24 4.24m0 5.66l-4.24 4.24"></path>
        </svg>
        <span class="navbar-button-text">Settings</span>
      </button>
      <button type="button" id="authButton" class="navbar-button auth-button" onclick="handleSignIn()" title="Sign in with Google">
        <img id="userAvatar" class="user-avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="User avatar" style="display: none;">
        <svg id="authIcon" class="navbar-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span id="authButtonText" class="navbar-button-text">Sign In</span>
      </button>
    </div>
  </nav>

  <main class="container">

    <!-- MAIN SEARCH -->
    <section class="search-section">
      <div class="search-panel">
        <input
          id="query"
          type="text"
          placeholder="Search Plato, Ackoff, DIKW..."
          onkeydown="if(event.key==='Enter') search()"
        >

        <select id="sortOrder" title="Sort results">
          <option value="">Sort: Relevance</option>
          <option value="date_desc">Date: Newest â†’ Oldest</option>
          <option value="date_asc">Date: Oldest â†’ Newest</option>
          <option value="cite_desc">Citations: High â†’ Low</option>
          <option value="cite_asc">Citations: Low â†’ High</option>
        </select>

        <button type="button" onclick="toggleAdvanced()">Advanced â–¾</button>
        <button type="button" onclick="search()">Search</button>
      </div>
    </section>

    <!-- ADVANCED SEARCH -->
    <section class="advanced-section">
      <div id="advancedPanel" class="advanced-panel">
        <div class="adv-grid">
          <input id="exactPhrase" type="text" placeholder="Exact phrase (we add quotes for you)">

          <input id="titleTerm" type="text" placeholder="Title contains (filter: title.search)">
          <input
            id="abstractTerm"
            type="text"
            placeholder="Abstract contains (filter: abstract.search)"
          >

          <input id="authorName" type="text" placeholder="Author name (lookup â†’ author.id filter)">
          <input
            id="sourceName"
            type="text"
            placeholder="Source/Journal name (lookup â†’ source.id filter)"
          >

          <input id="fromYear" type="number" placeholder="From year (e.g., 1950)">
          <input id="toYear" type="number" placeholder="To year (e.g., 2026)">
        </div>

        <div class="adv-note">
          Author/Source filters use OpenAlex lookups (name â†’ OpenAlex ID â†’ works filter).
        </div>
      </div>
    </section>



    <!-- RESULTS -->
    <section class="results-section">
      <div id="results"></div>
    </section>
  </main>

  <div id="modal-create-project" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-create-project-title">
    <div class="modal__overlay">
      <div class="modal__container">
        <div class="modal__header">
          <h2 id="modal-create-project-title" class="modal__title">Create Project</h2>
          <button type="button" class="modal__close" aria-label="Close" onclick="closeProjectModal()"></button>
        </div>
        <form id="create-project-form">
          <div class="modal__content">
            <div class="form-group">
              <label for="project-name-input">Project name</label>
              <input id="project-name-input" type="text" autocomplete="off" required>
            </div>
            <div class="form-group">
              <label for="project-description-input">Description (optional)</label>
              <textarea id="project-description-input" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="project-gpt-instruction-input">GPT Instruction (optional)</label>
              <textarea id="project-gpt-instruction-input" rows="4" placeholder="Custom instructions for AI when generating text for bookmarks in this project..."></textarea>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="modal__btn modal__btn-secondary" onclick="closeProjectModal()">Cancel</button>
            <button type="submit" id="create-project-submit" class="modal__btn modal__btn-primary">Create</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-edit-project" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-edit-project-title">
    <div class="modal__overlay">
      <div class="modal__container">
        <div class="modal__header">
          <h2 id="modal-edit-project-title" class="modal__title">Edit Project</h2>
          <button type="button" class="modal__close" aria-label="Close" onclick="closeEditProjectModal()"></button>
        </div>
        <form id="edit-project-form">
          <div class="modal__content">
            <div class="form-group">
              <label for="edit-project-name-input">Project name</label>
              <input id="edit-project-name-input" type="text" autocomplete="off" required>
            </div>
            <div class="form-group">
              <label for="edit-project-description-input">Description (optional)</label>
              <textarea id="edit-project-description-input" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="edit-project-gpt-instruction-input">GPT Instruction (optional)</label>
              <textarea id="edit-project-gpt-instruction-input" rows="4" placeholder="Custom instructions for AI when generating text for bookmarks in this project..."></textarea>
            </div>
          </div>
          <div class="modal__footer">
            <button type="button" class="modal__btn modal__btn-secondary" onclick="closeEditProjectModal()">Cancel</button>
            <button type="submit" id="edit-project-submit" class="modal__btn modal__btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bookmark Added Notification Popup -->
  <div id="bookmark-notification" class="bookmark-notification hidden" role="status" aria-live="polite">
    <div class="bookmark-notification__icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
      </svg>
    </div>
    <div class="bookmark-notification__content">
      <div class="bookmark-notification__title">ðŸ”– Bookmark Added</div>
      <div class="bookmark-notification__message" id="bookmark-notification-message">Paper saved to your library</div>
    </div>
  </div>

  <!-- AI Generation Status Popup -->
  <div id="ai-generation-popup" class="ai-generation-popup hidden" role="status" aria-live="polite">
    <div class="ai-generation-popup__icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="11" width="18" height="10" rx="2"/>
        <circle cx="12" cy="5" r="2"/>
        <path d="M12 7v4"/>
        <line x1="8" y1="16" x2="8" y2="16"/>
        <line x1="16" y1="16" x2="16" y2="16"/>
      </svg>
    </div>
    <div class="ai-generation-popup__content">
      <div class="ai-generation-popup__title">ðŸ¤– AI is thinking...</div>
      <div class="ai-generation-popup__message" id="ai-generation-popup-message">Generating summary</div>
    </div>
  </div>

  <!-- Sync Status Notification -->
  <div id="syncStatus" class="sync-status" style="display: none;" role="status" aria-live="polite"></div>

  <script src="firebase.js"></script>
  <script src="script.js"></script>
</body>
</html>
