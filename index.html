<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Research Loader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/open-props/open-props.min.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="assets/site.css" />
</head>

<body>
  <main class="container">
    <header>
      <h1 class="title animate__animated animate__fadeInDown">ðŸ“š Research Loader</h1>
    </header>

    <!-- MAIN SEARCH -->
    <section class="search-section">
      <div class="search-panel">
        <input
          id="query"
          type="text"
          placeholder="Search Plato, Ackoff, DIKW..."
          onkeydown="if(event.key==='Enter') search()"
        />

        <select id="sortOrder" title="Sort results">
          <option value="">Sort: Relevance</option>
          <option value="date_desc">Date: Newest â†’ Oldest</option>
          <option value="date_asc">Date: Oldest â†’ Newest</option>
          <option value="cite_desc">Citations: High â†’ Low</option>
          <option value="cite_asc">Citations: Low â†’ High</option>
        </select>

        <button type="button" onclick="toggleAdvanced()">Advanced â–¾</button>
        <button type="button" onclick="search()">Search</button>
      </div>
    </section>

    <!-- ADVANCED SEARCH -->
    <section class="advanced-section">
      <div id="advancedPanel" class="advanced-panel">
        <div class="adv-grid">
          <input id="exactPhrase" type="text" placeholder="Exact phrase (we add quotes for you)" />

          <input id="titleTerm" type="text" placeholder="Title contains (filter: title.search)" />
          <input
            id="abstractTerm"
            type="text"
            placeholder="Abstract contains (filter: abstract.search)"
          />

          <input id="authorName" type="text" placeholder="Author name (lookup â†’ author.id filter)" />
          <input
            id="sourceName"
            type="text"
            placeholder="Source/Journal name (lookup â†’ source.id filter)"
          />

          <input id="fromYear" type="number" placeholder="From year (e.g., 1950)" />
          <input id="toYear" type="number" placeholder="To year (e.g., 2026)" />
        </div>

        <div class="adv-section">
          <div class="adv-section-title">
            OpenAI ChatGPT (Research Notes)
            <span class="help-links">
              <a
                href="https://platform.openai.com/api-keys"
                target="_blank"
                rel="noopener"
                title="Get your OpenAI API key"
              >Get API Key</a>
            </span>
          </div>

          <div class="adv-grid">
            <input
              id="openaiApiKey"
              type="password"
              placeholder="OpenAI API key (stored locally)"
            />
            <button type="button" onclick="validateOpenAIKey()">Validate Key</button>
          </div>

          <div id="openaiValidationStatus" class="adv-note"></div>

          <div id="openaiConfigPanel" style="display: none;">
            <div class="adv-grid">
              <select id="openaiModel" title="ChatGPT Model">
                <option value="gpt-4o-mini">GPT-4o Mini (Fast & Affordable)</option>
                <option value="gpt-4o">GPT-4o (Recommended)</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              </select>

              <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                <label for="openaiTemperature" style="font-size: 0.875rem;">Temperature: <span id="tempValue">0.7</span></label>
                <input
                  id="openaiTemperature"
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  value="0.7"
                  oninput="document.getElementById('tempValue').textContent = this.value"
                />
              </div>

              <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                <label for="openaiMaxTokens" style="font-size: 0.875rem;">Max Tokens: <span id="tokensValue">300</span></label>
                <input
                  id="openaiMaxTokens"
                  type="range"
                  min="100"
                  max="500"
                  step="50"
                  value="300"
                  oninput="document.getElementById('tokensValue').textContent = this.value"
                />
              </div>
            </div>

            <button type="button" onclick="saveOpenAISettings()">Save ChatGPT Settings</button>
          </div>
        </div>

        <div class="adv-section">
          <div class="adv-section-title">
            Google Source Finder (Bookmarks)
            <span class="help-links">
              <a
                href="https://developers.google.com/custom-search/v1/introduction"
                target="_blank"
                rel="noopener"
                title="How to get an API key + set up Programmable Search Engine"
              >Help</a>
              <span class="dot">â€¢</span>
              <a
                href="https://support.google.com/programmable-search/answer/12499034?hl=en"
                target="_blank"
                rel="noopener"
                title="How to find your Search Engine ID (cx)"
              >Find cx</a>
            </span>
          </div>

          <div class="adv-grid">
            <input
              id="googleApiKey"
              type="password"
              placeholder="Google Custom Search API key (stored locally)"
            />
            <input id="googleCx" type="text" placeholder="Search Engine ID (cx) (stored locally)" />
            <button type="button" onclick="saveGoogleSettings()">Save Google Settings</button>
          </div>

          <div id="googleSettingsStatus" class="adv-note">
            Tip: Restrict your API key by HTTP referrer to your GitHub Pages domain.
          </div>
        </div>

        <div class="adv-note">
          Author/Source filters use OpenAlex lookups (name â†’ OpenAlex ID â†’ works filter).
          In bookmarks, the Google Source Finder uses your saved Google key + cx to try to locate
          essay text first, then related citations.
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="results-section">
      <div id="results"></div>
    </section>
  </main>

  <script src="script.js"></script>
</body>
</html>
